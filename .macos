#!/usr/bin/env bash

# ~/.macos
# based on:
# https://github.com/mathiasbynens/dotfiles/blob/master/.macos
# https://github.com/kentcdodds/dotfiles/blob/master/.macos

# Close any open System Preferences panes, to prevent them from overriding
# settings weâ€™re about to change
osascript -e 'tell application "System Preferences" to quit'

# Ask for the administrator password upfront
sudo -v

# Keep-alive: update existing `sudo` time stamp until `.macos` has finished
while true; do sudo -n true; sleep 60; kill -0 "$$" || exit; done 2>/dev/null &

echo "Hello $(whoami)! Let's start!"

echo "Configure zsh and oh-my-zsh"

# set zsh as the default shell
chsh -s $(which zsh)

# install oh-my-zsh
sh -c "$(curl -fsSL https://raw.githubusercontent.com/robbyrussell/oh-my-zsh/master/tools/install.sh)"

echo "Cloning dotfiles repository"
git clone https://github.com/mfklauberg/dotfiles "${HOME}/dotfiles"

ln -s "${HOME}/dotfiles/.zshrc" "${HOME}/.zshrc"
ln -s "${HOME}/dotfiles/.gitconfig" "${HOME}/.gitconfig"
ln -s "${HOME}/dotfiles/.gitignore" "${HOME}/.gitignore"
ln -s "${HOME}/dotfiles/.npmrc" "${HOME}/.npmrc"

echo "Creating symbolic link to Airport"
ln -s /System/Library/PrivateFrameworks/Apple80211.framework/Versions/Current/Resources/airport /usr/local/bin/airport

echo "Installing node and some global dependencies"
curl -L https://git.io/n-install | bash

echo "node --version: $(node --version)"
echo "npm --version: $(npm --version)"

echo "Setup expected folders"

mkdir -p "${HOME}/projects"

